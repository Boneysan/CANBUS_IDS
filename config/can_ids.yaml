# CAN-IDS Main Configuration File
# System settings
log_level: INFO
interface: can0
bustype: socketcan

# Detection settings
rules_file: config/rules_adaptive.yaml  # Switched to adaptive rules (Dec 16, 2025) - fixes 100% FP rate
ml_threshold: 0.75
detection_modes:
  - rule_based
  # - ml_based  # Temporarily disabled - models need to be retrained in CANBUS_IDS context
  # See docs/ML_MODEL_ISSUE.md for details

# Alert settings
alerts:
  log_file: logs/alerts.json
  console_output: true
  email_alerts: false
  email_recipients:
    - security@example.com
  rate_limit: 10  # Max alerts per second
  
# Capture settings
capture:
  buffer_size: 1000
  pcap_enabled: true
  pcap_directory: data/raw/
  pcap_rotation_size: 100MB

# Stage 3: Decision Tree ML Detector (Phase 3 - Option D)
decision_tree:
  enabled: true
  model_path: data/models/decision_tree.pkl
  visualization_path: data/models/decision_tree_rules.txt

# ML settings
ml_model:
  path: data/models/aggressive_load_shedding.joblib  # Optimized multi-stage pipeline
  # Alternative models available:
  # - adaptive_weighted_detector.joblib (95.9% recall, 100% precision - BEST ACCURACY)
  # - enhanced_detector.joblib (with 13 CAN-specific features)
  contamination: 0.20  # Tuned for higher recall (was 0.02)
  retrain_interval: 86400  # 24 hours in seconds
  auto_update: false

# Enhanced ML Detection with Multi-Stage Pipeline
ml_detection:
  enable_multistage: true
  
  # Multi-stage settings
  multistage:
    models_dir: "models"
    enable_adaptive_gating: true
    enable_load_shedding: true
    max_stage3_load: 0.15  # Limit Stage 3 to 15% for Pi4 optimization
    enable_vehicle_calibration: false  # Disable until vehicle detection is stable
    
    # Stage thresholds
    stage1_threshold: 0.0
    stage2_threshold: 0.5  
    stage3_threshold: 0.7
    
    # Performance monitoring
    enable_performance_monitoring: true
    stats_window_size: 1000
  
  # Fallback single-stage settings (if multistage fails)
  fallback:
    model_type: "isolation_forest"
    contamination: 0.02
    feature_window: 100

# Fast Pre-Filter (Milestone 1.2 - 2-3x performance gain)
prefilter:
  enabled: true
  timing_tolerance: 0.3  # Â±30% timing tolerance
  
  # Known good CAN IDs (extracted from real vehicle data)
  # These are the legitimate CAN IDs from the training dataset
  known_good_ids:
    - 0x0C1
    - 0x0C5
    - 0x120
    - 0x12A
    - 0x134
    - 0x138
    - 0x17F
    - 0x184
    - 0x191
    - 0x199
    - 0x19D
    - 0x1A1
    - 0x1C3
    - 0x1C7
    - 0x1CD
    - 0x221
    - 0x2C1
    - 0x2C3
    - 0x2C7
    - 0x2CD
    - 0x320
    - 0x334
    - 0x33C
    - 0x3C1
    - 0x3C5
    - 0x3D1
    - 0x3D5
    - 0x3D9
    - 0x3DD
    - 0x445
    - 0x449
    - 0x500
    - 0x514
    - 0x52A
    - 0x5C0
    - 0x771
    - 0x77F
    - 0x794
    - 0x7A0
    - 0x7C4
    - 0x7CD

# Performance settings
performance:
  max_cpu_percent: 80
  max_memory_mb: 500
  processing_threads: 2